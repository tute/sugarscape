<!doctype html>
<html>
  <head>
    <title>Sugarscape</title>
    <link rel="stylesheet" type="text/css" href="css/sugarscape.css">
  </head>
  <body>
    <h2>Instructions</h2>
    <p>Press "p" to play/pause the Sugarscape. It updates the wealth distribution plot.</p>
    <p>See code and more info in <a href="https://github.com/tute/sugarscape">GitHub</a>.</p>

    <table><tr>
      <td>
        <div id="sugarscape"></div>
      </td>
      <td>
        <div id="wealth" style="width:500px; height:300px;"></div>
        <br>
        <div id="chart" style="width:300px; height:200px;"></div>
      </td>
    </tr></table>

    <div id="form_controls">
      Frames per second:
      <input type="number" id="fps" value="30" min="1" max="60">
    </div>

    <script src='js/sugarscape.js'></script>
    <script src='js/highcharts-standalone.js'></script>
    <script src='js/highcharts.js'></script>
    <script src='js/sugarscape-charts.js'></script>
    <script>
      Sugarscape.Charts.initAliveAndDead();
      Sugarscape.Charts.initHistogram();

      var grid = new Sugarscape.Grid();
      var gridView = new Sugarscape.GridView(grid)
      gridView.render();

      var fps = 30; // Up to 60 frames per second
      var isPlaying = true;

      var fpsInput = document.getElementById('fps');
      fpsInput.addEventListener('input', function() {
        fps = fpsInput.value;
      });

      var tick = function() {
        setTimeout(function() {
          if (isPlaying) {
            if (Math.random() <= 0.75) {
              Sugarscape.Charts.updateAliveAndDead(grid.agents);
            }
            grid.wakeAgents();
            grid.growSugar();
            gridView.render();
          }
          requestAnimationFrame(tick);
        }, 1000 / fps);
      }

      window.onkeydown = function(event) {
        if (event.which == 80) {
          isPlaying = !isPlaying;
          Sugarscape.Charts.updateHistogram(grid.agents);
        }
      };

      Sugarscape.Charts.updateHistogram(grid.agents);
      tick();
    </script>
  </body>
</html>
